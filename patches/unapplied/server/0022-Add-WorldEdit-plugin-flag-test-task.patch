From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jason Penilla <11360596+jpenilla@users.noreply.github.com>
Date: Mon, 12 Feb 2024 22:19:03 -0700
Subject: [PATCH] Add WorldEdit plugin flag test task


diff --git a/build.gradle.kts b/build.gradle.kts
index ccdf5120013adfe9604d503dd3570bc74c2cca91..73b3e61cbbdf5025c24d289597648f01f632a5e3 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -1,9 +1,11 @@
 import io.papermc.paperweight.util.*
+import xyz.jpenilla.runpaper.task.RunServer
 
 plugins {
     java
     `maven-publish`
     id("com.github.johnrengelman.shadow")
+    id("xyz.jpenilla.run-paper") version "2.2.3" apply false
 }
 
 val log4jPlugins = sourceSets.create("log4jPlugins")
@@ -186,6 +188,25 @@ tasks.registerRunTask("runDevServer") {
     jvmArgs("-DPaper.pushPaperAssetsRoot=true")
 }
 
+tasks.register<RunServer>("runWithPlugins") {
+    version.set(providers.gradleProperty("mcVersion"))
+    runJar(rootProject.tasks.named<io.papermc.paperweight.tasks.CreateBundlerJar>("createMojmapBundlerJar").flatMap { it.outputZip })
+    downloadPlugins {
+        url("https://ci.enginehub.org/repository/download/bt10/23382:id/worldedit-bukkit-7.2.19-dist.jar?branch=version/7.2.x&guest=1")
+        url("https://www.patreon.com/file?h=89830486&i=15920178")
+        url("https://dev.bukkit.org/projects/grief-prevention/files/4433061/download")
+        github("EssentialsX", "Essentials", "2.20.1", "EssentialsX-2.20.1.jar")
+        hangar("squaremap", "1.2.3")
+        hangar("FancyHolograms", "2.0.5")
+        hangar("Chunky", "1.3.92")
+        hangar("Multiverse-Core", "4.3.12")
+        // Once they fix package parsing
+        // hangar("Denizen", "1.3.0-Build-1803")
+        // hangar("GrimAnticheat", "2.3.58")
+        // hangar("ProtocolLib", "5.1.0")
+    }
+    runDirectory.set(rootProject.layout.projectDirectory.dir("run"))
+}
 tasks.registerRunTask("runBundler") {
     description = "Spin up a test server from the Mojang mapped bundler jar"
     classpath(rootProject.tasks.named<io.papermc.paperweight.tasks.CreateBundlerJar>("createMojmapBundlerJar").flatMap { it.outputZip })
