From 5a51e51a849a44eeb57a149ca5aa2c8bdd59c3cb Mon Sep 17 00:00:00 2001
From: Jedediah Smith <jedediah@silencegreys.com>
Date: Fri, 28 Nov 2014 02:36:18 -0600
Subject: [PATCH] Center TNT grid sample points


diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index 4540baa..4af7973 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -1860,6 +1860,12 @@ public abstract class World implements IBlockAccess {
         double d1 = 1.0D / ((axisalignedbb.e - axisalignedbb.b) * 2.0D + 1.0D);
         double d2 = 1.0D / ((axisalignedbb.f - axisalignedbb.c) * 2.0D + 1.0D);
 
+        // PaperSpigot start - Center TNT sample points for more accurate calculations
+        // Shift the sample points so they are centered on the BB
+        double xOffset = (1.0 - Math.floor(1.0 / d0) * d0) / 2.0;
+        double zOffset = (1.0 - Math.floor(1.0 / d2) * d2) / 2.0;
+        // PaperSpigot end
+
         if (d0 >= 0.0D && d1 >= 0.0D && d2 >= 0.0D) {
             int i = 0;
             int j = 0;
@@ -1871,7 +1877,7 @@ public abstract class World implements IBlockAccess {
                         double d4 = axisalignedbb.b + (axisalignedbb.e - axisalignedbb.b) * (double) f1;
                         double d5 = axisalignedbb.c + (axisalignedbb.f - axisalignedbb.c) * (double) f2;
 
-                        if (this.rayTrace(new Vec3D(d3, d4, d5), vec3d) == null) {
+                        if (this.rayTrace(new Vec3D(xOffset, d4, zOffset + d5), vec3d) == null) { // PaperSpigot  - Center TNT sample points
                             ++i;
                         }
 
-- 
1.9.1

